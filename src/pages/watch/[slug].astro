---
import Layout from '@layouts/base.astro'
import { baseUrl } from '@utils'

const episode = new URLSearchParams(Astro.url.search).get('ep') ?? '1'

const [response] = await fetch(
  `${baseUrl}/api/getEpisode?slug=${Astro.params.slug}&ep=${episode}`
)
  .then((res) => res.json())
  .then((res) => res.episode)

const { video_urls } = response

console.log(video_urls)
---

<Layout>
  <lite-iframe
    id="lite-iframe"
    src="https://gogoanime.org.es/streaming.php?slug=one-piece-episode-1122"
    frameborder="no"
    allowtransparency="true"
    allowfullscreen="true"
    marginwidth="0"
    marginheight="0"
    scrolling="no"
    sandbox="allow-scripts "
  >
    <script is:inline>
      //   window.open = function () {
      //     console.warn('Intento de abrir una nueva ventana bloqueado.')
      //     return null
      //   }

      //   // Opcional: bloquear redirecciones autom치ticas
      //   window.onbeforeunload = function () {
      //     return 'Se intent칩 abrir una pesta침a o redirecci칩n.'
      //   }
    </script>
  </lite-iframe>
</Layout>
