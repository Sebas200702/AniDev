---
import Layout from '@layouts/base.astro'
import { HomeSectionsContainer } from '@shared/components/home-sections-container'
import { HomeGeneratorService } from '@shared/services/home-generator-service'
import { getSessionUserInfo } from '@utils/get_session_user_info'

// Obtener informaci√≥n del usuario desde cookies
const userInfo = await getSessionUserInfo({
  request: Astro.request,
  accessToken: Astro.cookies.get('sb-access-token')?.value,
  refreshToken: Astro.cookies.get('sb-refresh-token')?.value,
})

// Generar secciones del home (con cache Redis de 1 hora)
const sections = await HomeGeneratorService.buildHomeSections(
  userInfo?.id ?? null
)
---

<Layout>
  <HomeSectionsContainer
    initialSections={sections}
    userId={userInfo?.id ?? null}
    cacheMaxAgeHours={1}
    client:load
  />
</Layout>
